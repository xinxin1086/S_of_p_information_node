/**
 * Ë°®ÊÉÖÂ§ÑÁêÜÂ∑•ÂÖ∑ÂáΩÊï∞
 */

// Â∏∏Áî®Ë°®ÊÉÖÂàóË°®
export const COMMON_EMOJIS = [
  { code: ':)', emoji: 'üòä', name: 'ÂæÆÁ¨ë' },
  { code: ':(', emoji: 'üò¢', name: '‰º§ÂøÉ' },
  { code: ':D', emoji: 'üòÉ', name: 'ÂºÄÂøÉ' },
  { code: ':P', emoji: 'üòõ', name: 'Ë∞ÉÁöÆ' },
  { code: ':O', emoji: 'üòÆ', name: 'ÊÉäËÆ∂' },
  { code: ';)', emoji: 'üòâ', name: 'Áú®Áúº' },
  { code: ':|', emoji: 'üòê', name: 'Êó†Ë°®ÊÉÖ' },
  { code: ':/', emoji: 'üòï', name: 'Âõ∞ÊÉë' },
  { code: ':\'(', emoji: 'üò≠', name: 'Âì≠Ê≥£' },
  { code: '>:(', emoji: 'üò†', name: 'ÁîüÊ∞î' },
  { code: '<3', emoji: '‚ù§Ô∏è', name: 'Áà±ÂøÉ' },
  { code: ':*:', emoji: 'üíã', name: '‰∫≤Âêª' },
  { code: ':thumbsup:', emoji: 'üëç', name: 'Ëµû' },
  { code: ':thumbsdown:', emoji: 'üëé', name: 'Ë∏©' },
  { code: ':clap:', emoji: 'üëè', name: 'ÈºìÊéå' }
]

// Êõ¥Â§öË°®ÊÉÖÂàÜÁ±ª
export const EMOJI_CATEGORIES = {
  emotions: {
    name: 'ÊÉÖÁª™',
    emojis: [
      { emoji: 'üòä', code: ':smile:' },
      { emoji: 'üòÇ', code: ':joy:' },
      { emoji: 'üòç', code: ':heart_eyes:' },
      { emoji: 'ü§î', code: ':thinking:' },
      { emoji: 'üòé', code: ':cool:' },
      { emoji: 'ü§ó', code: ':hug:' },
      { emoji: 'ü§≠', code: ':speak_no_evil:' },
      { emoji: 'ü§´', code: ':shushing_face:' },
      { emoji: 'ü§Ø', code: ':exploding_head:' },
      { emoji: 'üòá', code: ':angel:' },
      { emoji: 'ü•∞', code: ':smiling_face_with_hearts:' },
      { emoji: 'üò≠', code: ':sob:' },
      { emoji: 'üò§', code: ':rage:' },
      { emoji: 'ü§¨', code: ':cursing_face:' },
      { emoji: 'ü§¢', code: ':nauseated_face:' },
      { emoji: 'ü§°', code: ':clown_face:' }
    ]
  },
  gestures: {
    name: 'ÊâãÂäø',
    emojis: [
      { emoji: 'üëç', code: ':thumbsup:' },
      { emoji: 'üëé', code: ':thumbsdown:' },
      { emoji: 'üëå', code: ':ok_hand:' },
      { emoji: '‚úåÔ∏è', code: ':victory_hand:' },
      { emoji: 'ü§û', code: ':crossed_fingers:' },
      { emoji: 'ü§ü', code: ':love_you_gesture:' },
      { emoji: 'ü§ò', code: ':metal:' },
      { emoji: 'üëè', code: ':clap:' },
      { emoji: 'üôå', code: ':raised_hands:' },
      { emoji: 'üëê', code: ':open_hands:' },
      { emoji: 'ü§≤', code: ':palms_up:' },
      { emoji: 'üôè', code: ':pray:' },
      { emoji: 'üí™', code: ':flexed_biceps:' },
      { emoji: 'ü´±', code: ':rightwards_hand:' },
      { emoji: 'ü´≤', code: ':leftwards_hand:' },
      { emoji: 'ü´≥', code: ':palm_down_hand:' }
    ]
  },
  animals: {
    name: 'Âä®Áâ©',
    emojis: [
      { emoji: 'üê∂', code: ':dog:' },
      { emoji: 'üê±', code: ':cat:' },
      { emoji: 'üê≠', code: ':mouse:' },
      { emoji: 'üêπ', code: ':hamster:' },
      { emoji: 'üê∞', code: ':rabbit:' },
      { emoji: 'ü¶ä', code: ':fox:' },
      { emoji: 'üêª', code: ':bear:' },
      { emoji: 'üêº', code: ':panda:' },
      { emoji: 'üê®', code: ':koala:' },
      { emoji: 'üêØ', code: ':tiger:' },
      { emoji: 'ü¶Å', code: ':lion:' },
      { emoji: 'üêÆ', code: ':cow:' },
      { emoji: 'üê∑', code: ':pig:' },
      { emoji: 'üê∏', code: ':frog:' },
      { emoji: 'üêµ', code: ':monkey:' },
      { emoji: 'ü¶Ñ', code: ':unicorn:' }
    ]
  },
  food: {
    name: 'È£üÁâ©',
    emojis: [
      { emoji: 'üçé', code: ':apple:' },
      { emoji: 'üçä', code: ':orange:' },
      { emoji: 'üçã', code: ':lemon:' },
      { emoji: 'üçå', code: ':banana:' },
      { emoji: 'üçâ', code: ':watermelon:' },
      { emoji: 'üçì', code: ':strawberry:' },
      { emoji: 'üçë', code: ':peach:' },
      { emoji: 'üçç', code: ':pineapple:' },
      { emoji: 'ü•ù', code: ':kiwi:' },
      { emoji: 'üçÖ', code: ':tomato:' },
      { emoji: 'ü••', code: ':coconut:' },
      { emoji: 'ü•ë', code: ':avocado:' },
      { emoji: 'üçî', code: ':hamburger:' },
      { emoji: 'üçü', code: ':fries:' },
      { emoji: 'üçï', code: ':pizza:' },
      { emoji: 'üå≠', code: ':hot_dog:' }
    ]
  },
  activities: {
    name: 'Ê¥ªÂä®',
    emojis: [
      { emoji: '‚öΩ', code: ':soccer_ball:' },
      { emoji: 'üèÄ', code: ':basketball:' },
      { emoji: 'üèà', code: ':american_football:' },
      { emoji: '‚öæ', code: ':baseball:' },
      { emoji: 'üéæ', code: ':tennis:' },
      { emoji: 'üèê', code: ':volleyball:' },
      { emoji: 'üèì', code: ':ping_pong:' },
      { emoji: 'üè∏', code: ':badminton:' },
      { emoji: 'ü•ä', code: ':boxing_glove:' },
      { emoji: 'üé£', code: ':fishing_pole:' },
      { emoji: 'üéπ', code: ':musical_keyboard:' },
      { emoji: 'üé∏', code: ':guitar:' },
      { emoji: 'üé∫', code: ':trumpet:' },
      { emoji: 'üé∑', code: ':saxophone:' },
      { emoji: 'ü•Å', code: ':drum:' },
      { emoji: 'üéÆ', code: ':video_game:' }
    ]
  },
  objects: {
    name: 'Áâ©ÂìÅ',
    emojis: [
      { emoji: 'üíé', code: ':gem:' },
      { emoji: 'üî•', code: ':fire:' },
      { emoji: '‚ö°', code: ':lightning:' },
      { emoji: 'üíß', code: ':droplet:' },
      { emoji: 'üåà', code: ':rainbow:' },
      { emoji: '‚òÄÔ∏è', code: ':sun:' },
      { emoji: 'üåô', code: ':moon:' },
      { emoji: '‚≠ê', code: ':star:' },
      { emoji: 'üí´', code: ':dizzy:' },
      { emoji: '‚òÑÔ∏è', code: ':comet:' },
      { emoji: 'üéâ', code: ':party_popper:' },
      { emoji: 'üéä', code: ':confetti_ball:' },
      { emoji: 'üéÅ', code: ':gift:' },
      { emoji: 'üéà', code: ':balloon:' },
      { emoji: 'üèÜ', code: ':trophy:' },
      { emoji: 'ü•á', code: ':1st_place_medal:' }
    ]
  },
  symbols: {
    name: 'Á¨¶Âè∑',
    emojis: [
      { emoji: '‚ù§Ô∏è', code: ':red_heart:' },
      { emoji: 'üß°', code: ':orange_heart:' },
      { emoji: 'üíõ', code: ':yellow_heart:' },
      { emoji: 'üíö', code: ':green_heart:' },
      { emoji: 'üíô', code: ':blue_heart:' },
      { emoji: 'üíú', code: ':purple_heart:' },
      { emoji: 'üñ§', code: ':black_heart:' },
      { emoji: 'ü§ç', code: ':white_heart:' },
      { emoji: 'üíî', code: ':broken_heart:' },
      { emoji: '‚ù£Ô∏è', code: ':exclamation_heart:' },
      { emoji: 'üíï', code: ':two_hearts:' },
      { emoji: 'üíû', code: ':revolving_hearts:' },
      { emoji: 'üíì', code: ':beating_heart:' },
      { emoji: 'üíñ', code: ':sparkling_heart:' },
      { emoji: 'üíó', code: ':growing_heart:' },
      { emoji: 'üíù', code: ':heart_with_ribbon:' }
    ]
  }
}

// Â∞ÜÊñáÊú¨‰∏≠ÁöÑË°®ÊÉÖ‰ª£Á†ÅËΩ¨Êç¢‰∏∫emoji
export const parseEmojis = (text) => {
  if (!text) return ''

  let parsedText = text

  // Ëß£ÊûêÂ∏∏Áî®Ë°®ÊÉÖ
  COMMON_EMOJIS.forEach(({ code, emoji }) => {
    const regex = new RegExp(escapeRegex(code), 'g')
    parsedText = parsedText.replace(regex, emoji)
  })

  // Ëß£ÊûêÂàÜÁ±ªË°®ÊÉÖ
  Object.values(EMOJI_CATEGORIES).forEach(category => {
    category.emojis.forEach(({ code, emoji }) => {
      const regex = new RegExp(escapeRegex(code), 'g')
      parsedText = parsedText.replace(regex, emoji)
    })
  })

  return parsedText
}

// Â∞ÜemojiËΩ¨Êç¢‰∏∫ÊñáÊú¨‰ª£Á†Å
export const encodeEmojis = (text) => {
  if (!text) return ''

  let encodedText = text

  // Ëß£ÊûêÂ∏∏Áî®Ë°®ÊÉÖ
  COMMON_EMOJIS.forEach(({ code, emoji }) => {
    const regex = new RegExp(escapeRegex(emoji), 'g')
    encodedText = encodedText.replace(regex, code)
  })

  // Ëß£ÊûêÂàÜÁ±ªË°®ÊÉÖ
  Object.values(EMOJI_CATEGORIES).forEach(category => {
    category.emojis.forEach(({ code, emoji }) => {
      const regex = new RegExp(escapeRegex(emoji), 'g')
      encodedText = encodedText.replace(regex, code)
    })
  })

  return encodedText
}

// ËΩ¨‰πâÊ≠£ÂàôË°®ËææÂºèÁâπÊÆäÂ≠óÁ¨¶
function escapeRegex(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
}

// Ëé∑ÂèñË°®ÊÉÖÈ¢ÑËßàÂàóË°®
export const getEmojiPreview = (category = null, limit = 20) => {
  let emojis = []

  if (category && EMOJI_CATEGORIES[category]) {
    emojis = EMOJI_CATEGORIES[category].emojis
  } else {
    // Ëé∑ÂèñÊâÄÊúâË°®ÊÉÖ
    Object.values(EMOJI_CATEGORIES).forEach(cat => {
      emojis = emojis.concat(cat.emojis)
    })
    // Ê∑ªÂä†Â∏∏Áî®Ë°®ÊÉÖ
    emojis = [...COMMON_EMOJIS, ...emojis]
  }

  return emojis.slice(0, limit)
}

// ÊêúÁ¥¢Ë°®ÊÉÖ
export const searchEmojis = (keyword) => {
  if (!keyword) return []

  const results = []
  const lowerKeyword = keyword.toLowerCase()

  // ÊêúÁ¥¢Â∏∏Áî®Ë°®ÊÉÖ
  COMMON_EMOJIS.forEach(emoji => {
    if (emoji.name.toLowerCase().includes(lowerKeyword) ||
        emoji.code.toLowerCase().includes(lowerKeyword)) {
      results.push(emoji)
    }
  })

  // ÊêúÁ¥¢ÂàÜÁ±ªË°®ÊÉÖ
  Object.entries(EMOJI_CATEGORIES).forEach(([categoryKey, category]) => {
    category.emojis.forEach(emoji => {
      if (emoji.code.toLowerCase().includes(lowerKeyword)) {
        results.push({
          ...emoji,
          category: category.name
        })
      }
    })
  })

  return results
}

// ÁªüËÆ°ÊñáÊú¨‰∏≠ÁöÑË°®ÊÉÖÊï∞Èáè
export const countEmojis = (text) => {
  if (!text) return 0

  let count = 0
  const emojiRegex = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu

  const matches = text.match(emojiRegex)
  if (matches) {
    count = matches.length
  }

  return count
}

// ÊèêÂèñÊñáÊú¨‰∏≠ÁöÑÊâÄÊúâË°®ÊÉÖ
export const extractEmojis = (text) => {
  if (!text) return []

  const emojiRegex = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu
  return text.match(emojiRegex) || []
}

// Ë°®ÊÉÖÈÄâÊã©Âô®ÈÖçÁΩÆ
export const EMOJI_PICKER_CONFIG = {
  categories: Object.keys(EMOJI_CATEGORIES),
  perLine: 8,
  maxRows: 6,
  emojiSize: 24,
  emojisToShow: 20,
  showSearch: true,
  showPreview: true,
  showSkinTones: false,
  showFrequentlyUsed: true,
  frequentlyUsedLimit: 10
}

export default {
  COMMON_EMOJIS,
  EMOJI_CATEGORIES,
  parseEmojis,
  encodeEmojis,
  getEmojiPreview,
  searchEmojis,
  countEmojis,
  extractEmojis,
  EMOJI_PICKER_CONFIG
}