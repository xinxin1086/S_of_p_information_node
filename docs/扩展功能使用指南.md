# å‰ç«¯æ‰©å±•åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†ä¸ºVueé¡¹ç›®è¡¥å……çš„å‰ç«¯åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ³¨å†Œã€TokenéªŒè¯ã€è®ºå›åŠŸèƒ½ã€ç»Ÿä¸€APIè·¯å¾„ã€é”™è¯¯å¤„ç†å’Œæƒé™æ§åˆ¶ç³»ç»Ÿã€‚

## ğŸš€ æ–°å¢åŠŸèƒ½åˆ—è¡¨

### 1. ç”¨æˆ·è®¤è¯æ‰©å±•
- âœ… ç”¨æˆ·æ³¨å†Œæ¥å£
- âœ… TokenéªŒè¯æ¥å£
- âœ… Tokenåˆ·æ–°æœºåˆ¶
- âœ… å¯†ç é‡ç½®åŠŸèƒ½
- âœ… é‚®ç®±/æ‰‹æœºéªŒè¯

### 2. è®ºå›åŠŸèƒ½æ¨¡å—
- âœ… å¸–å­ç®¡ç†ï¼ˆCRUDï¼‰
- âœ… æ¥¼å±‚å›å¤ç³»ç»Ÿ
- âœ… ç‚¹èµäº’åŠ¨åŠŸèƒ½
- âœ… å¸–å­æœç´¢å’Œåˆ†ç±»
- âœ… è®¿é—®ç»Ÿè®¡
- âœ… é€šçŸ¥ç³»ç»Ÿ
- âœ… ä¸¾æŠ¥æœºåˆ¶

### 3. ç»Ÿä¸€APIé…ç½®
- âœ… æ ‡å‡†åŒ–APIè·¯å¾„
- âœ… é”™è¯¯ç å®šä¹‰
- âœ… å“åº”æ ¼å¼è§„èŒƒ

### 4. å®Œå–„é”™è¯¯å¤„ç†
- âœ… ç»Ÿä¸€é”™è¯¯åˆ†ç±»
- âœ… ç”¨æˆ·å‹å¥½é”™è¯¯æ¶ˆæ¯
- âœ… é”™è¯¯æ—¥å¿—è®°å½•
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶

### 5. ä¼˜åŒ–æƒé™æ§åˆ¶
- âœ… ç»†ç²’åº¦æƒé™ç®¡ç†
- âœ… è§’è‰²ç­‰çº§ç³»ç»Ÿ
- âœ… æ¡ä»¶æƒé™æ£€æŸ¥
- âœ… æƒé™è£…é¥°å™¨

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ auth.ts          # è®¤è¯ç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ forum.ts         # è®ºå›ç›¸å…³ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ api.d.ts         # APIé€šç”¨ç±»å‹å®šä¹‰
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ index.js         # åŸæœ‰APIæ¥å£
â”‚   â””â”€â”€ extended.js      # æ‰©å±•APIæ¥å£
â”œâ”€â”€ config/
â”‚   â””â”€â”€ api.ts           # ç»Ÿä¸€APIè·¯å¾„é…ç½®
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ errorHandler.ts  # é”™è¯¯å¤„ç†æœºåˆ¶
â”‚   â”œâ”€â”€ permissions.ts   # æƒé™æ§åˆ¶ç³»ç»Ÿ
â”‚   â””â”€â”€ tokenManager.ts  # Tokenç®¡ç†ï¼ˆåŸæœ‰ï¼‰
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ auth.ts          # æ‰©å±•çš„è®¤è¯çŠ¶æ€ç®¡ç†
â””â”€â”€ components/
    â””â”€â”€ Forum/
        â””â”€â”€ ForumPostList.vue  # è®ºå›å¸–å­åˆ—è¡¨ç»„ä»¶
```

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### 1. ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½

```typescript
import { useAuthStore } from '@/stores/auth'

const authStore = useAuthStore()

// æ³¨å†Œç”¨æˆ·
const register = async (userData) => {
  try {
    const result = await authStore.register({
      account: 'username',
      username: 'ç”¨æˆ·å',
      password: 'password123',
      email: 'user@example.com',
      agreement_accepted: true
    })

    if (result.success) {
      console.log('æ³¨å†ŒæˆåŠŸ', result.user)
    }
  } catch (error) {
    console.error('æ³¨å†Œå¤±è´¥', error)
  }
}
```

### 2. TokenéªŒè¯

```typescript
// éªŒè¯å½“å‰Token
const isValid = await authStore.verifyCurrentToken()

// æ‰‹åŠ¨åˆ·æ–°Token
const refreshSuccess = await authStore.autoRefreshToken()
```

### 3. å¯†ç é‡ç½®

```typescript
// å‘é€é‡ç½®éªŒè¯ç 
await authStore.sendPasswordReset({
  account: 'user@example.com',
  verification_method: 'email'
})

// ç¡®è®¤å¯†ç é‡ç½®
await authStore.confirmPasswordReset({
  account: 'user@example.com',
  verification_code: '123456',
  new_password: 'newpassword123',
  confirm_password: 'newpassword123'
})
```

### 4. è®ºå›åŠŸèƒ½ä½¿ç”¨

#### è·å–å¸–å­åˆ—è¡¨
```typescript
import { forumApi } from '@/api/extended'

// è·å–å¸–å­åˆ—è¡¨
const posts = await forumApi.getPostList({
  page: 1,
  page_size: 20,
  category: 'discussion',
  sort_by: 'created_at'
})

// æœç´¢å¸–å­
const searchResults = await forumApi.searchPosts({
  keyword: 'Vue',
  page: 1,
  page_size: 10
})
```

#### åˆ›å»ºå¸–å­
```typescript
const newPost = await forumApi.createPost({
  title: 'å¸–å­æ ‡é¢˜',
  content: 'å¸–å­å†…å®¹...',
  category: 'discussion',
  tags: ['vue', 'frontend']
})
```

#### ç‚¹èµæ“ä½œ
```typescript
// ç‚¹èµ/å–æ¶ˆç‚¹èµ
await forumApi.toggleLike({
  target_type: 'post',
  target_id: 123
})

// è·å–ç‚¹èµçŠ¶æ€
const likeStatus = await forumApi.getLikeStatus({
  target_type: 'post',
  target_ids: [123, 456, 789]
})
```

### 5. ç»Ÿä¸€APIè·¯å¾„ä½¿ç”¨

```typescript
import { USER_AUTH_API, FORUM_API } from '@/config/api'

// ä½¿ç”¨é…ç½®å¥½çš„APIè·¯å¾„
const response = await api.post(USER_AUTH_API.REGISTER, userData)
const posts = await api.get(FORUM_API.POST, params)
```

### 6. é”™è¯¯å¤„ç†

```typescript
import { handleApiError, shouldRetryRequest } from '@/utils/errorHandler'

try {
  const result = await someApiCall()
} catch (error) {
  const apiError = handleApiError(error, {
    url: '/api/some-endpoint',
    method: 'POST'
  })

  // æ£€æŸ¥æ˜¯å¦åº”è¯¥é‡è¯•
  if (shouldRetryRequest(apiError)) {
    // æ‰§è¡Œé‡è¯•é€»è¾‘
  }
}
```

### 7. æƒé™æ§åˆ¶

```typescript
import { usePermissions } from '@/utils/permissions'
import { checkPermission, checkRole } from '@/utils/permissions'

const {
  permissionManager,
  checkPermission,
  checkRole
} = usePermissions()

// æ£€æŸ¥èµ„æºæƒé™
const canEditPost = checkPermission('forum_post', 'update', {
  ownerId: post.authorId
})

// æ£€æŸ¥è§’è‰²æƒé™
const isAdmin = checkRole('ADMIN')

// è·å–ç”¨æˆ·å¯è®¿é—®çš„èµ„æº
const accessibleResources = permissionManager.getAccessibleResources()
```

#### æƒé™è£…é¥°å™¨ä½¿ç”¨

```typescript
import { PermissionManager } from '@/utils/permissions'

class PostService {
  @PermissionManager.requirePermission('forum_post', 'create')
  async createPost(postData: any) {
    // åªæœ‰æœ‰æƒé™çš„ç”¨æˆ·æ‰èƒ½æ‰§è¡Œæ­¤æ–¹æ³•
  }

  @PermissionManager.requireRole('ADMIN')
  async deleteAllPosts() {
    // åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œæ­¤æ–¹æ³•
  }
}
```

---

## ğŸ¯ Vueç»„ä»¶ç¤ºä¾‹

### ForumPostListç»„ä»¶ç‰¹æ€§

è®ºå›å¸–å­åˆ—è¡¨ç»„ä»¶å±•ç¤ºäº†å¦‚ä½•æ•´åˆæ‰€æœ‰æ–°åŠŸèƒ½ï¼š

1. **æƒé™æ§åˆ¶**ï¼šæ ¹æ®ç”¨æˆ·æƒé™æ˜¾ç¤ºä¸åŒçš„æ“ä½œæŒ‰é’®
2. **APIè°ƒç”¨**ï¼šä½¿ç”¨ç»Ÿä¸€çš„è®ºå›APIæ¥å£
3. **é”™è¯¯å¤„ç†**ï¼šé›†æˆäº†é”™è¯¯å¤„ç†æœºåˆ¶
4. **ç”¨æˆ·äº¤äº’**ï¼šç‚¹èµã€æœç´¢ã€åˆ†é¡µç­‰åŠŸèƒ½
5. **å“åº”å¼è®¾è®¡**ï¼šåŸºäºVue 3 Composition API

```vue
<template>
  <div class="forum-post-list">
    <!-- æƒé™æ§åˆ¶æŒ‰é’® -->
    <el-button
      v-if="canCreatePost"
      type="primary"
      @click="handleCreatePost"
    >
      å‘å¸ƒå¸–å­
    </el-button>

    <!-- å¸–å­åˆ—è¡¨ -->
    <div v-for="post in posts" :key="post.id">
      <!-- æ ¹æ®æƒé™æ˜¾ç¤ºæ“ä½œæŒ‰é’® -->
      <el-button
        v-if="canEditPost(post.author_id)"
        @click="handleEditPost(post)"
      >
        ç¼–è¾‘
      </el-button>
    </div>
  </div>
</template>

<script setup>
import { usePermissions } from '@/utils/permissions'
import { forumApi } from '@/api/extended'

const { checkPermission } = usePermissions()

// æƒé™æ£€æŸ¥
const canCreatePost = computed(() => {
  return checkPermission('forum_post', 'create')
})

const canEditPost = (authorId) => {
  return checkPermission('forum_post', 'update', {
    ownerId: authorId
  })
}
</script>
```

---

## ğŸ” æƒé™ç­‰çº§è¯´æ˜

### è§’è‰²æƒé™ç­‰çº§

| è§’è‰² | ç­‰çº§ | æè¿° |
|------|------|------|
| VISITOR | 0 | è®¿å®¢ï¼ˆæœªç™»å½•ç”¨æˆ·ï¼‰ |
| USER | 100 | æ™®é€šç”¨æˆ· |
| ADMIN | 200 | ç®¡ç†å‘˜ |
| SUPER_ADMIN | 300 | è¶…çº§ç®¡ç†å‘˜ |

### æƒé™èµ„æºç±»å‹

- `user_profile`: ç”¨æˆ·èµ„æ–™ç®¡ç†
- `forum_post`: è®ºå›å¸–å­æ“ä½œ
- `forum_reply`: è®ºå›å›å¤æ“ä½œ
- `content_create`: å†…å®¹åˆ›å»º
- `content_moderate`: å†…å®¹å®¡æ ¸
- `system_config`: ç³»ç»Ÿé…ç½®

### æƒé™æ“ä½œç±»å‹

- `create`: åˆ›å»º
- `read`: è¯»å–
- `update`: æ›´æ–°
- `delete`: åˆ é™¤
- `manage`: ç®¡ç†
- `moderate`: å®¡æ ¸

---

## ğŸ“Š é”™è¯¯å¤„ç†æœºåˆ¶

### é”™è¯¯ç±»å‹åˆ†ç±»

1. **ç½‘ç»œé”™è¯¯**ï¼šè¿æ¥å¤±è´¥ã€è¶…æ—¶ç­‰
2. **è®¤è¯é”™è¯¯**ï¼šTokenè¿‡æœŸã€æœªç™»å½•ç­‰
3. **æƒé™é”™è¯¯**ï¼šæƒé™ä¸è¶³ç­‰
4. **éªŒè¯é”™è¯¯**ï¼šå‚æ•°éªŒè¯å¤±è´¥ç­‰
5. **æœåŠ¡å™¨é”™è¯¯**ï¼šæœåŠ¡ç«¯å¼‚å¸¸ç­‰
6. **ä¸šåŠ¡é”™è¯¯**ï¼šä¸šåŠ¡é€»è¾‘é”™è¯¯ç­‰

### é”™è¯¯å¤„ç†ç­–ç•¥

1. **è‡ªåŠ¨é‡è¯•**ï¼šç½‘ç»œé”™è¯¯å’ŒæœåŠ¡å™¨é”™è¯¯æ”¯æŒè‡ªåŠ¨é‡è¯•
2. **ç”¨æˆ·å‹å¥½æç¤º**ï¼šæ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºåˆé€‚çš„æç¤ºä¿¡æ¯
3. **é”™è¯¯æ—¥å¿—**ï¼šè®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ç”¨äºè°ƒè¯•
4. **é”™è¯¯ç¼“å­˜**ï¼šé˜²æ­¢é‡å¤æ˜¾ç¤ºç›¸åŒé”™è¯¯

---

## ğŸš€ æœ€ä½³å®è·µ

### 1. APIè°ƒç”¨

- ä½¿ç”¨ç»Ÿä¸€çš„APIè·¯å¾„é…ç½®
- é›†æˆé”™è¯¯å¤„ç†æœºåˆ¶
- æ”¯æŒè‡ªåŠ¨é‡è¯•æœºåˆ¶
- æ­£ç¡®å¤„ç†åŠ è½½çŠ¶æ€

### 2. æƒé™æ§åˆ¶

- åœ¨UIå±‚å’ŒAPIå±‚éƒ½è¿›è¡Œæƒé™æ£€æŸ¥
- ä½¿ç”¨ç»†ç²’åº¦æƒé™æ§åˆ¶
- è€ƒè™‘æƒé™æ¡ä»¶é™åˆ¶
- æä¾›æƒé™åé¦ˆ

### 3. é”™è¯¯å¤„ç†

- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- å®ç°åˆç†çš„é‡è¯•ç­–ç•¥
- åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯

### 4. çŠ¶æ€ç®¡ç†

- ä½¿ç”¨Piniaè¿›è¡ŒçŠ¶æ€ç®¡ç†
- æ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œ
- ä¿æŒçŠ¶æ€çš„ä¸€è‡´æ€§
- æä¾›çŠ¶æ€é‡ç½®åŠŸèƒ½

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-12-16)

- âœ… å®Œæˆç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- âœ… å®ŒæˆTokenéªŒè¯æœºåˆ¶
- âœ… å®Œæˆè®ºå›æ¨¡å—API
- âœ… å®Œæˆç»Ÿä¸€APIé…ç½®
- âœ… å®Œæˆé”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å®Œæˆæƒé™æ§åˆ¶ç³»ç»Ÿ
- âœ… æä¾›ç¤ºä¾‹ç»„ä»¶å’Œæ–‡æ¡£

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. éµå¾ªç°æœ‰çš„ä»£ç è§„èŒƒ
2. æ·»åŠ é€‚å½“çš„ç±»å‹å®šä¹‰
3. ç¼–å†™å•å…ƒæµ‹è¯•
4. æ›´æ–°ç›¸å…³æ–‡æ¡£
5. ç¡®ä¿å‘åå…¼å®¹æ€§

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–åˆ›å»ºIssueã€‚